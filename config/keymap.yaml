# Unified Keymap Configuration

# Base layer metadata
base_layers:
  BASE_PRIMARY:
    display_name: "NIGHT"
    description: "Primary layout (Night with JP swap and magic)"
  BASE_ALT:
    display_name: "NIGHT"
    description: "Vanilla Night"
  BASE_ALT2:
    display_name: "NIGHT"
    description: "LHM Night"

layers:

  BASE_PRIMARY:
    core: # (3x5)
      left:
        - [B              , F              , L              , D              , Q              ]
        - [hrm:LGUI:N     , hrm:LALT:S     , hrm:LCTL:H     , hrm:LSFT:T     , K              ]
        - [X              , V              , M              , P              , Z              ]
      right:
        - [J              , G              , O              , U              , sm:DOT:GRV     ]
        - [Y              , hrm:LSFT:C     , hrm:LCTL:A     , hrm:LALT:E     , hrm:LGUI:I     ]
        - [QUOT           , W              , MINS           , SLSH           , sm:COMM:AT     ]
      thumbs:
        - [lt:NUM:MAGIC   , lt:SYM:R       ,   mt:LSFT:BSPC]
        - [mt:LSFT:TAB    , lt:NAV:SPC      , lt:MEDIA:ENT   ]
    extensions:
      3x6_3:
        outer_pinky_left: [NONE, REPEAT, NONE]
        outer_pinky_right: [NONE, REPEAT, NONE]

  BASE_ALT:
    core: # (3x5)
      left:
        - [B              , F              , L              , K              , Q              ]
        - [hrm:LGUI:N     , hrm:LALT:S     , hrm:LCTL:H     , hrm:LSFT:T     , M              ]
        - [X              , V              , J              , D              , Z              ]
      right:
        - [P              , G              , O              , U              , sm:DOT:GRV     ]
        - [Y              , hrm:LSFT:C     , hrm:LCTL:A     , hrm:LALT:E     , hrm:LGUI:I     ]
        - [QUOT           , W              , MINS           , SLSH           , sm:COMM:AT     ]
      thumbs:
        - [lt:NUM:MAGIC   , lt:SYM:R       , mt:LSFT:BSPC   ]
        - [mt:LSFT:TAB    , lt:NAV:SPC     , lt:MEDIA:ENT   ]
    extensions:
      3x6_3:
        outer_pinky_left: [NONE, NONE, NONE]
        outer_pinky_right: [NONE, NONE, NONE]

  BASE_ALT2:
    core: # (3x5)
      left:
        - [B              , F              , L              , K              , Q              ]
        - [hrm:LGUI:N     , hrm:LALT:S     , hrm:LCTL:H     , hrm:LSFT:T     , M              ]
        - [X              , V              , P              , D              , Z              ]
      right:
        - [J              , G              , O              , U              , sm:DOT:GRV     ]
        - [Y              , hrm:LSFT:C     , hrm:LCTL:A     , hrm:LALT:E     , hrm:LGUI:I     ]
        - [QUOT           , W              , MINS           , SLSH           , sm:COMM:AT     ]
      thumbs:
        - [lt:NUM:MAGIC   , lt:SYM:R       ,   mt:LSFT:BSPC]
        - [mt:LSFT:TAB    , lt:NAV:SPC      , lt:MEDIA:ENT   ]
    extensions:
      3x6_3:
        outer_pinky_left: [NONE, REPEAT, NONE]
        outer_pinky_right: [NONE, REPEAT, NONE]

  # Supporting layers
  SYM:
    core: # (3x5)
      left:
        - [NONE           , NONE           , TILD           , osl:NUM            , NONE           ]
        - [hrm:LGUI:AMPR     , hrm:LALT:PERC     , hrm:LCTL:DLR     , hrm:LSFT:RABK     , BSLS              ]
        - [CIRC           , PIPE           , HASH           , RBRC           , NONE           ]
      right:
        - [LABK           , PLUS           , LCBR           , RCBR           , EQL            ]
        - [SCLN           , EXLM           , LPRN           , RPRN           , COLN           ]
        - [DQUO           , ASTR           , LBRC           , QUES           , COMM           ]
      thumbs:
        - [NONE           , NONE           , NONE           ]
        - [MAGIC          , SPC            , ENT            ]
    extensions:
      3x6_3:
        outer_pinky_left: [TRANS, TRANS, TRANS]
        outer_pinky_right: [TRANS, TRANS, TRANS]

  # SYM:
  #   core: # (3x5)
  #     left:
  #       - [TILD           , AMPR           , PERC           , DLR            , NONE           ]
  #       - [LGUI           , LALT           , LCTL           , LSFT           , BSLS           ]
  #       - [CIRC           , PIPE           , HASH           , RABK           , NONE           ]
  #     right:
  #       - [LABK           , ASTR           , LCBR           , RCBR           , EQL            ]
  #       - [SCLN           , EXLM           , LPRN           , RPRN           , COLN           ]
  #       - [DQUO           , PLUS           , LBRC           , RBRC           , COMM           ]
  #     thumbs:
  #       - [NONE           , NONE           , NONE           ]
  #       - [MAGIC          , SPC            , ENT            ]
  #   extensions:
  #     3x6_3:
  #       outer_pinky_left: [TRANS, TRANS, TRANS]
  #       outer_pinky_right: [TRANS, TRANS, TRANS]

  NUM:
    core: # (3x5)
      left:
        - [NONE           , NONE           , TILD            , osl:SYM           , NONE           ]
        - [hrm:LGUI:AMPR     , hrm:LALT:PERC     , hrm:LCTL:DLR     , hrm:LSFT:RABK     , BSLS              ]
        - [UNDO           , CUT            , COPY           , PASTE          , REDO           ]
      right:
        - [LBRC           , 7              , 8              , 9              , DOT            ]
        - [RBRC           , 1              , 2              , 3              , 0           ]
        - [HASH           , 4              , 5              , 6              , COMM           ]
      thumbs:
        - [NONE           , NONE           , NONE           ]
        - [MAGIC          , SPC            , ENT              ]
    extensions:
      3x6_3:
        outer_pinky_left: [TRANS, TRANS, TRANS]
        outer_pinky_right: [TRANS, TRANS, TRANS]

  NAV:
    core: # (3x5)
      left:
        - [NONE           , PGUP           , NONE           , NONE           , ESC            ]
        - [NONE           , LEFT           , UP             , RGHT           , CAPS           ]
        - [END            , PGDN           , DOWN           , HOME           , INS            ]
      right:
        - [NONE           , NONE           , NONE           , NONE           , NONE           ]
        - [NONE      , LSFT           , LCTL           , LALT           , LGUI           ]
        - [NONE           , NONE           , NONE           , NONE           , NONE           ]
      thumbs:
        - [DEL            , ENT            , BSPC            ]
        - [NONE           , NONE           , NONE           ]
    extensions:
      3x6_3:
        outer_pinky_left: [TRANS, TRANS, TRANS]
        outer_pinky_right: [TRANS, TRANS, TRANS]

  MEDIA:
    core: # (3x5)
      left:
        - [df:BASE_PRIMARY, df:BASE_ALT    , df:BASE_ALT2   , NONE           , NONE           ]
        - [MNXT           , VOLU           , VOLD           , MPRV           , NONE           ]
        - [UNDO           , CUT            , COPY           , PASTE          , REDO           ]
      right:
        - [BT_SEL_0       , BT_SEL_1       , BT_SEL_2       , BT_SEL_3       , BT_CLR         ]
        - [NONE           , LSFT           , LCTL           , LALT           , LGUI           ]
        - [NONE           , NONE           , NONE           , NONE           , DFU            ]
      thumbs:
        - [MUTE           , MPLY           , MSTP           ]
        - [NONE           , NONE           , NONE           ]
    extensions:
      3x6_3:
        outer_pinky_left: [TRANS, TRANS, TRANS]
        outer_pinky_right: [TRANS, TRANS, TRANS]

# Combo definitions
# NOTE: Positions use row-wise 36-key numbering (see CLAUDE.md for diagram)
# Combos trigger at physical positions regardless of active layer's key assignments
# Positions are automatically translated for larger boards (3x6_3, etc.)
combos:
  - name: dfu_left
    description: "Enter bootloader (left hand)"
    key_positions: [0, 4, 24]  # Top-left corner + top-right + bottom-right of left hand
    action: DFU
    timeout_ms: 100  # Slightly longer for easier chord
    require_prior_idle_ms: 150  # Prevent during fast typing (ZMK only)
    layers: [BASE_PRIMARY, BASE_ALT, BASE_ALT2]

  - name: dfu_right
    description: "Enter bootloader (right hand)"
    key_positions: [5, 9, 25]  # Top-left + top-right corner + bottom-left of right hand
    action: DFU
    timeout_ms: 100  # Slightly longer for easier chord
    require_prior_idle_ms: 150  # Prevent during fast typing (ZMK only)
    layers: [BASE_PRIMARY, BASE_ALT, BASE_ALT2]

  - name: github_url
    description: "Expand to GitHub repo URL"
    key_positions: [6, 7, 8, 9]  # Right hand top row (positions 2-5)
    action: MACRO_GITHUB_URL
    macro_text: "https://github.com/daranguiz/keyboard-config?tab=readme-ov-file#readme"
    timeout_ms: 100  # Slightly longer for 4-key combo
    layers: [BASE_PRIMARY, BASE_ALT, BASE_ALT2]

  - name: pd_to_ph
    description: "PD combo produces PH"
    key_positions: [22, 23]  # P and D on left hand bottom row
    action: MACRO_PH
    macro_text: "ph"
    timeout_ms: 20
    layers: [BASE_PRIMARY]


# Magic key definitions
# Context-aware keys that produce different outputs based on previous keypress
# Used to provide alternate bigrams for uncomfortable key combinations
magic_keys:
  BASE_PRIMARY:
    timeout_ms: 1000  # 0 = no max idle constraint for adaptive key triggers
    mappings:
      " ": THE
      ",": " BUT"
      "-": ">"
      ".": "/"
      P: L
      L: P
      C: Y
      G: Y

      B: EFORE
      I: ON
      J: UST
      M: ENT
      N: ION
      Q: UE
      T: ION
      W: HICH

      "<": ">"
      "[": "]"
      "(": "_"
      "/": "*"
      "*": "/"
    default_repeat: true

  BASE_ALT:
    timeout_ms: 0
    mappings:
      " ": THE
      ",": " BUT"
      "-": ">"
      ".": "/"
    default_repeat: true

  BASE_ALT2:
    timeout_ms: 0
    mappings:
      " ": THE
      ",": " BUT"
      "-": ">"
      ".": "/"
      C: Y
      G: Y

      "<": ">"
      "[": "]"
      "(": "_"
      "/": "*"
      "*": "/"
    default_repeat: true
